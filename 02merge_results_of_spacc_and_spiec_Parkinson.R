setwd("F:\\Zhaolab2020\\BioNetwork\\MicrobiomeNetwork\\MNDnetwork\\PRJEB17784\\co-network")

input.path="F:\\Zhaolab2020\\BioNetwork\\MicrobiomeNetwork\\MNDnetwork\\PRJEB17784\\co-network"
output.path="F:\\Zhaolab2020\\BioNetwork\\MicrobiomeNetwork\\MNDnetwork\\PRJEB17784\\co-network\\sparcc_spiec_output"
sparcc.path=file.path(input.path,"01network_edges_pass_FDR_Parkinson.csv")
spiec.path=file.path(input.path, "02spiec.easi_result_Parkinson.csv")

###使用两列来进行表连接。
##参考：https://stackoverflow.com/questions/6709151/how-do-i-combine-two-data-frames-based-on-two-columns
sparcc=read.csv(sparcc.path, head=TRUE)
#print(sparcc)
print(sparcc[1:3, 1:3])
spiec=read.csv(spiec.path, head=TRUE)
print(spiec[1:3, 1:4])

merge_table1 = merge(sparcc, spiec, by.x=c("species1", "species2"), by.y=c("start", "end"))
print(merge_table1[1:5, 1:6])
print(dim(merge_table1))

merge_table2 = merge(sparcc, spiec, by.x=c("species1", "species2"), by.y=c("end", "start"))
print(merge_table2[1:5, 1:6])
print(dim(merge_table2))

merge_table = rbind(merge_table1, merge_table2)
print(merge_table)
print(dim(merge_table))

merge_table$score=NA
for(i in 1:nrow(merge_table)){
  merge_table$score[i]=merge_table$coefficient[i]*merge_table$Cor[i] #3:102 columns represent fake coefficient generated by 100x permutation
}
print(merge_table[1:5,])
print(dim(merge_table))
merge_table_filtered <- subset(merge_table, merge_table$score>0)
print(dim(merge_table_filtered))

write.csv(merge_table_filtered[, c(1,2,3)], file = "03merge_sparcc_spiec_edge_lists_Parkinson.csv", row.names = FALSE)
write.csv(merge_table_filtered[, c(1,2,3)], file = "03merge_sparcc_spiec_all_Parkinson.csv", row.names = FALSE)